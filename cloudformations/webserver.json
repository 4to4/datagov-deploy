{  
   "AWSTemplateFormatVersion":"2010-09-09",
   "Description":"catalog-deploy ec2 stack",
   "Parameters":{  
      "InstanceType":{  
         "Type":"String",
         "Default":"m3.medium",
         "AllowedValues":[  
            "t2.micro",
            "t2.small",
            "m3.medium",
            "m4.large",
            "m4.xlarge"
         ]
      },
      "ImageId":{  
         "Type":"String",
         "Default":"ami-45826e2e"
      },
      "AvailabilityZone":{  
         "Type":"String",
         "Default":"us-east-1a",
         "AllowedValues":[  
            "us-east-1a",
            "us-east-1b",
            "us-east-1c",
            "us-east-1d"
         ]
      },
      "KeyName":{  
         "Type":"String",
         "Default":"ckan-csw-aws"
      },
      "Environment":{  
         "Type":"String",
         "Default":"develop",
         "AllowedValues":[  
            "develop",
            "qa",
            "prod"
         ]
      },
      "ElasticIP":{  
         "Type":"String",
         "Default":"54.197.246.60"
      }
   },
   "Resources":{  
      "EC2Instance":{  
         "Type":"AWS::EC2::Instance",
         "Properties":{  
            "AvailabilityZone":{  
               "Ref":"AvailabilityZone"
            },
            "ImageId":{  
               "Ref":"ImageId"
            },
            "InstanceType":{  
               "Ref":"InstanceType"
            },
            "KeyName":{  
               "Ref":"KeyName"
            },
            "SecurityGroups":[  
               {  
                  "Ref":"CatalogDeploySecurityGroup"
               }
            ],
            "Tags":[  
               {  
                  "Key":"Name",
                  "Value":"catalog-deploy"
               },
               {  
                  "Key":"owner",
                  "Value":"dan.olaru"
               },
               {  
                  "Key":"Environment",
                  "Value":{  
                     "Ref":"Environment"
                  }
               }
            ]
         }
      },
      "CatalogDeploySecurityGroup":{  
         "Type":"AWS::EC2::SecurityGroup",
         "Properties":{  
            "GroupDescription":"Security group for Catalog Deploy ckan web server",
            "SecurityGroupIngress":[  
               {  
                  "IpProtocol":"tcp",
                  "FromPort":"80",
                  "ToPort":"80",
                  "CidrIp":"0.0.0.0/0"
               },
               {  
                  "IpProtocol":"tcp",
                  "FromPort":"22",
                  "ToPort":"22",
                  "CidrIp":"65.242.97.254/32"
               },
               {  
                  "IpProtocol":"tcp",
                  "FromPort":"22",
                  "ToPort":"22",
                  "CidrIp":"54.243.131.201/32"
               }

            ]
         }
      },
      "IPAssoc":{  
         "Type":"AWS::EC2::EIPAssociation",
         "Properties":{  
            "InstanceId":{  
               "Ref":"EC2Instance"
            },
            "EIP":{  
               "Ref":"ElasticIP"
            }
         }
      }
   }
}
